long_df_all_f$species == 7 ~ "POAU",
long_df_all_f$species == 1 ~ "POSY")
# Convert to long data frame for endo effect
long_df_all_s <- as.data.frame.table(all_endoeffect_posts,
responseName = "value") %>%
rename(draw = iterations, species = Var2, year = Var3, endo_effect = value) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006, species=as.integer(species))
long_df_all_s$spec <- case_when(long_df_all_s$species == 8 ~ "AGPE",
long_df_all_s$species == 2 ~ "ELRI",
long_df_all_s$species == 3 ~ "ELVI",
long_df_all_s$species == 4 ~ "FESU",
long_df_all_s$species == 5 ~ "LOAR",
long_df_all_s$species == 6 ~ "POAL",
long_df_all_s$species == 7 ~ "POAU",
long_df_all_s$species == 1 ~ "POSY")
summary_df_all_s <- long_df_all_s %>%
group_by(year,spec) %>%
summarize(
median = median(endo_effect),
lower = quantile(endo_effect, 0.05),
upper = quantile(endo_effect, 0.95),
probgzero = mean(endo_effect>0),
.groups = "drop")
#plotting endo effect
ggplot(summary_df_all_s, aes(x = year, y = median)) +
geom_line(linewidth = 0.5, col = "mediumpurple3") +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, fill = "mediumpurple", color = NA) + #should color = species
labs(x = "Year", y = "Endophyte effect",
title = "Difference of E+ and E- flowering with year") +
geom_hline(yintercept = 0) +
theme_minimal()+
facet_grid("spec")
##PLOTTING CORRELATION COEFFICENTS
#take a random subset of posterior draws for correlation coefficients
all_corr_posts<-params_all_s$Omega[sample(dim(params_all_s$Omega)[1],size=1000,replace=F),,1,2]
dim(all_corr_posts)
## Convert to long data frame for correlation coefficients
long_df_all_corrs <- as.data.frame.table(all_corr_posts,
responseName = "value") %>%
rename(draw = Var1, species = Var2, corr = value) %>%
mutate(draw = as.integer(draw), species=as.integer(species))
long_df_all_corrs$spec <- case_when(long_df_all_corrs$species == 8 ~ "AGPE",
long_df_all_corrs$species == 2 ~ "ELRI",
long_df_all_corrs$species == 3 ~ "ELVI",
long_df_all_corrs$species == 4 ~ "FESU",
long_df_all_corrs$species == 5 ~ "LOAR",
long_df_all_corrs$species == 6 ~ "POAL",
long_df_all_corrs$species == 7 ~ "POAU",
long_df_all_corrs$species == 1 ~ "POSY")
#plotting correlation coefficients
summary_df_all_corrs <- long_df_all_corrs %>%
group_by(spec) %>% #should i group by species as well
summarize(
mean = mean(corr),
median = median(corr),
lower = quantile(corr, 0.05),
upper = quantile(corr, 0.95),
probgzero = mean(corr>0),
.groups = "drop")
summary_df_all_corrs
long_df_all_corrs
ggplot(long_df_all_corrs)+
geom_histogram(aes (x=corr), fill="mediumpurple",binwidth = 0.02)+
facet_grid("spec")+xlim(-0.5,1) +
geom_vline(data = summary_df_all_corrs,
aes(xintercept = mean),
colour = "mediumpurple4",
size=0.75,
linetype = "dashed")
#annotate with means manually on google slides
long_df_all_corrs %>% group_by(spec) %>% summarize(mean = mean(corr, na.rm = TRUE))
##PLOTTING ENDO ESTIMATES
#take a random subset of posterior draws for endo effect
all_beta0_posts<-params_all_s$beta_0[sample(dim(params_all_s$beta_0)[1],size=1000,replace=F),,,]
dim(all_beta0_posts)
# Convert to long data frame for endo effect
long_df_all_beta0s <- as.data.frame.table(all_beta0_posts,
responseName = "estimate") %>%
rename(draw = iterations, species = Var2, endo = Var3, year = Var4, estimate = estimate) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006, species=as.integer(species))
long_df_all_beta0s$spec <- case_when(long_df_all_beta0s$species == 8 ~ "AGPE",
long_df_all_beta0s$species == 2 ~ "ELRI",
long_df_all_beta0s$species == 3 ~ "ELVI",
long_df_all_beta0s$species == 4 ~ "FESU",
long_df_all_beta0s$species == 5 ~ "LOAR",
long_df_all_beta0s$species == 6 ~ "POAL",
long_df_all_beta0s$species == 7 ~ "POAU",
long_df_all_beta0s$species == 1 ~ "POSY")
summary_df_all_beta0s <- long_df_all_beta0s %>%
group_by(year,spec,endo) %>%
summarize(
median = median(estimate),
lower = quantile(estimate, 0.05),
upper = quantile(estimate, 0.95),
probgzero = mean(estimate>0),
.groups = "drop")
#plotting endo effect
ggplot(summary_df_all_beta0s, aes(x = year, y = median, colour = endo, fill = endo)) +
scale_color_manual(values = c("deeppink1", "cornflowerblue")) +
scale_fill_manual(values = c("deeppink1", "cornflowerblue")) +
geom_line(linewidth = 0.5) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
labs(x = "Year", y = "Endophyte effect",
title = "Difference of E+ and E- flowering with year") +
geom_hline(yintercept = 0) +
theme_minimal()+
facet_grid("spec")
#Important packages
library(tidyverse)
library(lme4)
library(rstan)
library(googlesheets4)
library(bayesplot)
options(mc.cores = parallel::detectCores())
#setwd("G:/.shortcut-targets-by-id/1o66WMnQligL0_-ahkQMfFOklR3X-6vOA/Akiem PhD Research/Data & Analysis")
setwd("/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage")
gras <- read.csv("data/ltreb_allspp_2007_2025.csv")
##Making integers for species
gras$spec <- as.integer (case_when(gras$species == "AGPE" ~ 8,
gras$species == "ELRI" ~ 2,
gras$species == "ELVI" ~ 3,
gras$species == "FESU" ~ 4,
gras$species == "LOAR" ~ 5,
gras$species == "POAL" ~ 6,
gras$species == "POAU" ~ 7,
gras$species == "POSY" ~ 1))
##centering size
gras$log_tillers_centered <- log(gras$size_t) - mean(log(gras$size_t),na.rm=T)
##prep data, dropping NAs
gras %>% filter (spec!=8) %>%
select(flw_count_t,endo_01,log_tillers_centered,size_t,year_t,plot,spec,original) %>%
drop_na() -> all_flow
mean(log(gras$size_t)
summarize(mean(log(gras$size_t1)))
mean(log(gras$size_t1))
mean((log(gras$size_t1))na.rm=T)
mean((log(gras$size_t1)),na.rm=T)
log(gras$size_t) - mean(log(gras$size_t),na.rm=T)
fessub(gras$size_t) - mean(log(fessub$size_t),na.rm=T)
##Species filter
fessub <- gras %>% filter(species == "FESU")
fessub$log_tillers_centered <- log(fessub$size_t) - mean(log(fessub$size_t),na.rm=T)
fessub(gras$size_t) - mean(log(fessub$size_t),na.rm=T)
log(fessub$size_t) - mean(log(fessub$size_t),na.rm=T)
mean(log(fessub$size_t),na.rm=T)
##Species filter
agrper <- gras %>% filter(species == "AGPE")
agrper$log_tillers_centered <- log(agrper$size_t) - mean(log(agrper$size_t),na.rm=T)
mean(log(agrper$size_t),na.rm=T)
##prep data, dropping NAs
poaals %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> poaals_flow
##Species filter
poaals <- gras %>% filter(species == "POAL")
poaals$log_tillers_centered <- log(poaals$size_t) - mean(log(poaals$size_t),na.rm=T)
mean(log(poaals$size_t),na.rm=T)
##Species filter
poasyl <- gras %>% filter(species == "POSY")
poasyl$log_tillers_centered <- log(poasyl$size_t) - mean(log(poasyl$size_t),na.rm=T)
mean(log(poasyl$size_t),na.rm=T)
##Making integers for species
gras$spec <- as.integer (case_when(gras$species == "AGPE" ~ 8,
gras$species == "ELRI" ~ 2,
gras$species == "ELVI" ~ 3,
gras$species == "FESU" ~ 4,
gras$species == "LOAR" ~ 5,
gras$species == "POAL" ~ 6,
gras$species == "POAU" ~ 7,
gras$species == "POSY" ~ 1))
##centering size
gras$log_tillers_centered <- log(gras$size_t) - mean(log(gras$size_t),na.rm=T)
gras$log_tillers_centered
mean(log(gras$size_t),na.rm=T)
##centering size
gras %>% filter (size_t==0 & surv_t1==1)
##centering size
gras %>% filter (size_t==0 & surv_t1==1) %>% View
##centering size
gras %>% filter (size_t1==0 & surv_t1==1) %>% View
##centering size
gras %>% filter (size_t1==0) %>% View
mean(log(gras$size_t)
mean(log(gras$size_t)
mean(log(gras$size_t))
mean(gras$size_t)
mean((gras$size_t),na.rm=T)
View((gras$size_t),na.rm=T)
View((gras$size_t))
View(gras$size_t)
##centering size
gras %>% filter (size_t==0) %>% View
##centering size
gras %>% filter (size_t==0) %>% View
View(gras)
gras %>% filter (species=="POAU", plot==79) %>% View
gras %>% filter (species=="POAU", id==79 1164 4) %>% View
gras %>% filter (species=="POAU", id=="79 1164 4") %>% View
?df
gras[!(id=="79 1164 4"),] %>% View
gras[!(id=="79 1164 4"),] %>% head
gras[!(gras$id=="79 1164 4"),] %>% View
gras[!(gras$id=="79 1164 4"),] <- gras
gras[!(gras$id=="79 1164 4"),]
gras %>% filter (species=="POAU", id=="79 1164 4") %>% View
gras <- gras[!(gras$id=="79 1164 4"),]
gras %>% filter (species=="POAU", id=="79 1164 4") %>% View
#Important packages
library(tidyverse)
library(lme4)
library(rstan)
library(googlesheets4)
library(bayesplot)
options(mc.cores = parallel::detectCores())
#setwd("G:/.shortcut-targets-by-id/1o66WMnQligL0_-ahkQMfFOklR3X-6vOA/Akiem PhD Research/Data & Analysis")
setwd("/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage")
gras <- read.csv("data/ltreb_allspp_2007_2025.csv")
##removing row with size_t = 0, it only applies to one ID in one year
gras %>% filter (species=="POAU", id=="79 1164 4") %>% View
gras <- gras[!(gras$id=="79 1164 4"),]
##Making integers for species
gras$spec <- as.integer (case_when(gras$species == "AGPE" ~ 8,
gras$species == "ELRI" ~ 2,
gras$species == "ELVI" ~ 3,
gras$species == "FESU" ~ 4,
gras$species == "LOAR" ~ 5,
gras$species == "POAL" ~ 6,
gras$species == "POAU" ~ 7,
gras$species == "POSY" ~ 1))
##centering size
gras$log_tillers_centered <- log(gras$size_t) - mean(log(gras$size_t),na.rm=T)
gras$log_tillers_centered
##prep data, dropping NAs
gras %>% filter (spec!=8) %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot,spec,original) %>%
drop_na() -> all_flow
all_flow_dat <- list(n_obs=nrow(all_flow),
y=all_flow$flw_count_t>0,
n_yrs = length(unique(all_flow$year_t)),
n_plots = max(all_flow$plot),
n_endo = 2,
n_spp = length(unique(all_flow$spec)),
endo_01=all_flow$endo_01,
size=all_flow$log_tillers_centered,
year_index=all_flow$year_t-2006,
plot=all_flow$plot,
species=all_flow$spec,
original=all_flow$original)
all_flow_model = stan_model(file="code/flowering_mvn.stan")
#saveRDS(all_flow_sampling,"all_flow_sampling.rds")
all_flow_sampling<-readRDS("all_flow_sampling.rds")
mcmc_trace(all_flow_sampling,par=c('endo_effect[1,5]'))
mcmc_trace(all_flow_sampling,par=c('Omega[1,1,2]'))
mcmc_dens(all_flow_sampling,par=c('Omega[1,1,2]'))
mcmc_dens(all_flow_sampling,par=c('Omega[2,1,2]'))
mcmc_dens(all_flow_sampling,par=c('Omega[2,1,2]'))
#extracting parameters
params_all_f<-rstan::extract(all_flow_sampling,pars=c('beta_0','endo_effect','Omega'))
dim(params_all_f$beta_0)
dim(params_all_f$Omega)
##PLOTTING ENDO EFFECT (DIFFERENCE)
#take a random subset of posterior draws for endo effect
all_endoeffect_postf<-params_all_f$endo_effect[sample(dim(params_all_f$endo_effect)[1],size=1000,replace=F),,]
dim(all_endoeffect_postf)
# Convert to long data frame for endo effect
long_df_all_f <- as.data.frame.table(all_endoeffect_postf,
responseName = "value") %>%
rename(draw = iterations, species = Var2, year = Var3, endo_effect = value) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006, species=as.integer(species))
long_df_all_f$spec <- case_when(long_df_all_f$species == 8 ~ "AGPE",
long_df_all_f$species == 2 ~ "ELRI",
long_df_all_f$species == 3 ~ "ELVI",
long_df_all_f$species == 4 ~ "FESU",
long_df_all_f$species == 5 ~ "LOAR",
long_df_all_f$species == 6 ~ "POAL",
long_df_all_f$species == 7 ~ "POAU",
long_df_all_f$species == 1 ~ "POSY")
summary_df_all_f <- long_df_all_f %>%
group_by(year,spec) %>% #should i group by species as well
summarize(
median = median(endo_effect),
lower = quantile(endo_effect, 0.05),
upper = quantile(endo_effect, 0.95),
probgzero = mean(endo_effect>0),
.groups = "drop")
#plotting endo effect
ggplot(summary_df_all_f, aes(x = year, y = median)) +
geom_line(linewidth = 0.5, col = "mediumpurple3") +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, fill = "mediumpurple", color = NA) + #should color = species
labs(x = "Year", y = "Endophyte effect",
title = "Difference of E+ and E- flowering with year") +
geom_hline(yintercept = 0) +
theme_minimal()+
facet_grid("spec")
##PLOTTING CORRELATION COEFFICENTS
#take a random subset of posterior draws for correlation coefficients
all_corr_postf<-params_all_f$Omega[sample(dim(params_all_f$Omega)[1],size=1000,replace=F),,1,2]
dim(all_corr_postf)
## Convert to long data frame for correlation coefficients
long_df_all_corrf <- as.data.frame.table(all_corr_postf,
responseName = "value") %>%
rename(draw = Var1, species = Var2, corr = value) %>%
mutate(draw = as.integer(draw), species=as.integer(species))
long_df_all_corrf$spec <- case_when(long_df_all_corrf$species == 8 ~ "AGPE",
long_df_all_corrf$species == 2 ~ "ELRI",
long_df_all_corrf$species == 3 ~ "ELVI",
long_df_all_corrf$species == 4 ~ "FESU",
long_df_all_corrf$species == 5 ~ "LOAR",
long_df_all_corrf$species == 6 ~ "POAL",
long_df_all_corrf$species == 7 ~ "POAU",
long_df_all_corrf$species == 1 ~ "POSY")
#plotting correlation coefficients
summary_df_all_corrf <- long_df_all_corrf %>%
group_by(spec) %>% #should i group by species as well
summarize(
mean = mean(corr),
median = median(corr),
lower = quantile(corr, 0.05),
upper = quantile(corr, 0.95),
probgzero = mean(corr>0),
.groups = "drop")
ggplot(long_df_all_corrf)+
geom_histogram(aes (x=corr), fill="mediumpurple",binwidth = 0.02)+
facet_grid("spec")+xlim(-0.5,1) +
geom_vline(data = summary_df_all_corrf,
aes(xintercept = mean),
colour = "mediumpurple4",
size=0.75,
linetype = "dashed")
#annotate with means manually on google slides
long_df_all_corrf %>% group_by(spec) %>% summarize(mean = mean(corr, na.rm = TRUE))
##PLOTTING ENDO ESTIMATES
#take a random subset of posterior draws for endo effect
all_beta0_postf<-params_all_f$beta_0[sample(dim(params_all_f$beta_0)[1],size=1000,replace=F),,,]
dim(all_beta0_postf)
# Convert to long data frame for endo effect
long_df_all_beta0f <- as.data.frame.table(all_beta0_postf,
responseName = "estimate") %>%
rename(draw = iterations, species = Var2, endo = Var3, year = Var4, estimate = estimate) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006, species=as.integer(species))
long_df_all_beta0f$spec <- case_when(long_df_all_beta0f$species == 8 ~ "AGPE",
long_df_all_beta0f$species == 2 ~ "ELRI",
long_df_all_beta0f$species == 3 ~ "ELVI",
long_df_all_beta0f$species == 4 ~ "FESU",
long_df_all_beta0f$species == 5 ~ "LOAR",
long_df_all_beta0f$species == 6 ~ "POAL",
long_df_all_beta0f$species == 7 ~ "POAU",
long_df_all_beta0f$species == 1 ~ "POSY")
summary_df_all_beta0f <- long_df_all_beta0f %>%
group_by(year,spec,endo) %>%
summarize(
median = median(estimate),
lower = quantile(estimate, 0.05),
upper = quantile(estimate, 0.95),
probgzero = mean(estimate>0),
.groups = "drop")
#plotting endo estimates
ggplot(summary_df_all_beta0f, aes(x = year, y = median, colour = endo, fill = endo)) +
scale_color_manual(values = c("deeppink1", "cornflowerblue")) +
scale_fill_manual(values = c("deeppink1", "cornflowerblue")) +
geom_line(linewidth = 0.5) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
labs(x = "Year", y = "probability of flowering",
title = "Change in probability of E+ and E- flowering with year") +
geom_hline(yintercept = 0) +
theme_minimal()+
facet_grid("spec")
##prep data, dropping NAs
gras %>% filter (spec!=8) %>%
select(surv_t1,endo_01,log_tillers_centered,year_t,plot,original,spec) %>%
drop_na() -> all_surv
all_surv_dat <- list(n_obs=nrow(all_surv),
y=all_surv$surv_t1,
n_yrs = length(unique(all_surv$year_t)),
n_plots = max(all_surv$plot),
n_endo = 2,
n_spp = length(unique(all_surv$spec)),
endo_01=all_surv$endo_01,
size=log(all_surv$size_t),
year_index=all_surv$year_t-2006,
plot=all_surv$plot,
species=all_surv$spec,
original=all_surv$original)
all_surv_dat <- list(n_obs=nrow(all_surv),
y=all_surv$surv_t1,
n_yrs = length(unique(all_surv$year_t)),
n_plots = max(all_surv$plot),
n_endo = 2,
n_spp = length(unique(all_surv$spec)),
endo_01=all_surv$endo_01,
size=all_surv$log_tillers_centered,
year_index=all_surv$year_t-2006,
plot=all_surv$plot,
species=all_surv$spec,
original=all_surv$original)
all_surv_model = stan_model(file = "code/flowering_mvn.stan")
#saveRDS(all_surv_sampling,"all_surv_sampling.rds")
all_surv_sampling<-readRDS("all_surv_sampling.rds")
mcmc_trace(all_surv_sampling,par=c('endo_effect[1,5]'))
mcmc_trace(all_surv_sampling,par=c('Omega[1,1,2]'))
mcmc_dens(all_surv_sampling,par=c('Omega[1,1,2]'))
#extracting parameters
params_all_s<-rstan::extract(all_surv_sampling,pars=c('beta_0','endo_effect','Omega'))
dim(params_all_s$beta_0)
dim(params_all_s$Omega)
##PLOTTING ENDO EFFECT (DIFFERENCE)
#take a random subset of posterior draws for endo effect
all_endoeffect_posts<-params_all_s$endo_effect[sample(dim(params_all_s$endo_effect)[1],size=1000,replace=F),,]
dim(all_endoeffect_posts)
# Convert to long data frame for endo effect
long_df_all_s <- as.data.frame.table(all_endoeffect_posts,
responseName = "value") %>%
rename(draw = iterations, species = Var2, year = Var3, endo_effect = value) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006, species=as.integer(species))
long_df_all_s$spec <- case_when(long_df_all_s$species == 8 ~ "AGPE",
long_df_all_s$species == 2 ~ "ELRI",
long_df_all_s$species == 3 ~ "ELVI",
long_df_all_s$species == 4 ~ "FESU",
long_df_all_s$species == 5 ~ "LOAR",
long_df_all_s$species == 6 ~ "POAL",
long_df_all_s$species == 7 ~ "POAU",
long_df_all_s$species == 1 ~ "POSY")
summary_df_all_s <- long_df_all_s %>%
group_by(year,spec) %>%
summarize(
median = median(endo_effect),
lower = quantile(endo_effect, 0.05),
upper = quantile(endo_effect, 0.95),
probgzero = mean(endo_effect>0),
.groups = "drop")
#plotting endo effect
ggplot(summary_df_all_s, aes(x = year, y = median)) +
geom_line(linewidth = 0.5, col = "mediumpurple3") +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, fill = "mediumpurple", color = NA) + #should color = species
labs(x = "Year", y = "Endophyte effect",
title = "Difference of E+ and E- flowering with year") +
geom_hline(yintercept = 0) +
theme_minimal()+
facet_grid("spec")
##PLOTTING CORRELATION COEFFICENTS
#take a random subset of posterior draws for correlation coefficients
all_corr_posts<-params_all_s$Omega[sample(dim(params_all_s$Omega)[1],size=1000,replace=F),,1,2]
dim(all_corr_posts)
## Convert to long data frame for correlation coefficients
long_df_all_corrs <- as.data.frame.table(all_corr_posts,
responseName = "value") %>%
rename(draw = Var1, species = Var2, corr = value) %>%
mutate(draw = as.integer(draw), species=as.integer(species))
long_df_all_corrs$spec <- case_when(long_df_all_corrs$species == 8 ~ "AGPE",
long_df_all_corrs$species == 2 ~ "ELRI",
long_df_all_corrs$species == 3 ~ "ELVI",
long_df_all_corrs$species == 4 ~ "FESU",
long_df_all_corrs$species == 5 ~ "LOAR",
long_df_all_corrs$species == 6 ~ "POAL",
long_df_all_corrs$species == 7 ~ "POAU",
long_df_all_corrs$species == 1 ~ "POSY")
#plotting correlation coefficients
summary_df_all_corrs <- long_df_all_corrs %>%
group_by(spec) %>% #should i group by species as well
summarize(
mean = mean(corr),
median = median(corr),
lower = quantile(corr, 0.05),
upper = quantile(corr, 0.95),
probgzero = mean(corr>0),
.groups = "drop")
ggplot(long_df_all_corrs)+
geom_histogram(aes (x=corr), fill="mediumpurple",binwidth = 0.02)+
facet_grid("spec")+xlim(-0.5,1) +
geom_vline(data = summary_df_all_corrs,
aes(xintercept = mean),
colour = "mediumpurple4",
size=0.75,
linetype = "dashed")
#annotate with means manually on google slides
long_df_all_corrs %>% group_by(spec) %>% summarize(mean = mean(corr, na.rm = TRUE))
##PLOTTING ENDO ESTIMATES
#take a random subset of posterior draws for endo effect
all_beta0_posts<-params_all_s$beta_0[sample(dim(params_all_s$beta_0)[1],size=1000,replace=F),,,]
dim(all_beta0_posts)
# Convert to long data frame for endo effect
long_df_all_beta0s <- as.data.frame.table(all_beta0_posts,
responseName = "estimate") %>%
rename(draw = iterations, species = Var2, endo = Var3, year = Var4, estimate = estimate) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006, species=as.integer(species))
long_df_all_beta0s$spec <- case_when(long_df_all_beta0s$species == 8 ~ "AGPE",
long_df_all_beta0s$species == 2 ~ "ELRI",
long_df_all_beta0s$species == 3 ~ "ELVI",
long_df_all_beta0s$species == 4 ~ "FESU",
long_df_all_beta0s$species == 5 ~ "LOAR",
long_df_all_beta0s$species == 6 ~ "POAL",
long_df_all_beta0s$species == 7 ~ "POAU",
long_df_all_beta0s$species == 1 ~ "POSY")
summary_df_all_beta0s <- long_df_all_beta0s %>%
group_by(year,spec,endo) %>%
summarize(
median = median(estimate),
lower = quantile(estimate, 0.05),
upper = quantile(estimate, 0.95),
probgzero = mean(estimate>0),
.groups = "drop")
#plotting endo effect
ggplot(summary_df_all_beta0s, aes(x = year, y = median, colour = endo, fill = endo)) +
scale_color_manual(values = c("deeppink1", "cornflowerblue")) +
scale_fill_manual(values = c("deeppink1", "cornflowerblue")) +
geom_line(linewidth = 0.5) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
labs(x = "Year", y = "Endophyte effect",
title = "Change in probability of E+ and E- flowering with year") +
geom_hline(yintercept = 0) +
theme_minimal()+
facet_grid("spec")
