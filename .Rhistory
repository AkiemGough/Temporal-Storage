plot (jitter(ilex$mean_temp_30yrnorm), jitter(ilex$profemtrees),
xlab= "30-year normal mean temperature (°F)",
ylab= "proportion of female trees",
pch= 21,
cex= ilex$Location,
col= "magenta4",
bg=alpha("magenta2", 0.25))
(ilex$tottrees <- ilex$females + ilex$males)
(ilex$profemtrees <- ilex$females / (ilex$females + ilex$males))
(ilex$tottrees <- ilex$females + ilex$males)
plot (jitter(ilex$mean_temp_30yrnorm), jitter(ilex$profemtrees),
xlab= "30-year normal mean temperature (°F)",
ylab= "proportion of female trees",
pch= 21,
cex= ilex$tottrees,
col= "magenta4",
bg=alpha("magenta2", 0.25))
(ilex$profemtrees <- ilex$females / (ilex$females + ilex$males))
(ilex$tottrees <- ilex$females + ilex$males)
plot (jitter(ilex$mean_temp_30yrnorm), jitter(ilex$females),
xlab= "30-year normal mean temperature (°F)",
ylab= "proportion of female trees",
pch= 21,
cex= ilex$tottrees,
col= "magenta4",
bg=alpha("magenta2", 0.25))
(ilex$profemtrees <- ilex$females / (ilex$females + ilex$males))
(ilex$tottrees <- ilex$females + ilex$males)
plot (jitter(ilex$mean_temp_30yrnorm), jitter(ilex$profemtrees),
xlab= "30-year normal mean temperature (°F)",
ylab= "proportion of female trees",
pch= 21,
cex= ilex$tottrees,
col= "magenta4",
bg=alpha("magenta2", 0.25))
prob_treefem <- glm(cbind(females,tottrees)~mean_temp_30yrnorm,family="binomial",data=ilex)
(prob_treefem <- glm(cbind(females,tottrees)~mean_temp_30yrnorm,family="binomial",data=ilex))
(prob_treefem <- glm(cbind(females,tottrees)~mean_temp_30yrnorm,family="binomial",data=ilex))
summary(prob_treefem)
ilex
plot (jitter(ilex$mean_temp_30yrnorm), jitter(ilex$profemtrees),
xlab= "30-year normal mean temperature (°F)",
ylab= "proportion of female trees",
pch= 21,
cex= ilex$tottrees,
col= "magenta4",
bg=alpha("magenta2", 0.25))
x_tempon <-seq(from=min(ilex$mean_temp_30yrnorm), to=max(ilex$mean_temp_30yrnorm), by=0.1)
lines(x_tempon,exp(coef(prob_treefem)[1]+coef(prob_treefem)[2]*x_tempon),col="grey0", lty=1, lwd=2)
library(DHARMa)
simulateResiduals(prob_treefem)
prob_treefem_resid <- DHARMa::simulateResiduals(prob_treefem)
plot(prob_treefem_resid)
(ilex$profemtrees <- ilex$females / (ilex$females + ilex$males))
(ilex$tottrees <- ilex$females + ilex$males)
plot (jitter(ilex$mean_temp_30yrnorm), jitter(ilex$profemtrees),
xlab= "30-year normal mean temperature (°F)",
ylab= "proportion of female trees",
pch= 21,
cex= ilex$tottrees,
col= "magenta4",
bg=alpha("magenta2", 0.2))
(ilex$profemtrees <- ilex$females / (ilex$females + ilex$males))
(ilex$tottrees <- ilex$females + ilex$males)
plot (jitter(ilex$mean_temp_30yrnorm), jitter(ilex$profemtrees),
xlab= "30-year normal mean temperature (°F)",
ylab= "proportion of female trees",
pch= 21,
cex= ilex$tottrees,
col= "magenta4",
bg=alpha("magenta2", 0.15))
(ilex$profemtrees <- ilex$females / (ilex$females + ilex$males))
(ilex$tottrees <- ilex$females + ilex$males)
plot (jitter(ilex$mean_temp_30yrnorm), jitter(ilex$profemtrees),
xlab= "30-year normal mean temperature (°F)",
ylab= "proportion of female trees",
pch= 21,
cex= ilex$tottrees,
col= "green",
bg=alpha("magenta2", 0.15))
###Importing data set
compcoe <- read.csv("/Users/akiemgough/Desktop/RESEARCH/Datar/ltreb_allspp_qaqc.csv",stringsAsFactors = T)
library(tidyverse)
library(scales)
library(lme4)
library(car)
library(AICcmodavg)
library(glmmTMB)
##Making columns for color distinctions for endophyte status
compcoe$colorvar <- case_when(compcoe$endo_01 == 1 ~"slateblue4",compcoe$endo_01 == 0 ~"goldenrod4")
compcoe$coloUrvar <- case_when(compcoe$endo_01 == 1 ~"slateblue",compcoe$endo_01 == 0 ~"goldenrod")
##Filtering for Poa Alsodes
poaals <- compcoe %>% filter(species == "POAL")
str(poaals)
poaals
##making year x variables for graphs
(x_yrs<- seq(from=2007,to=2021,by=1))
##making size x variables for graphs
(size_dummy<-seq(from=0,to=max(log(poaals$size_t),na.rm=T),by=0.1))
##coercing year into a factor
year_tf <- as.factor(poaals$year_t)
#creating logistic function
logistic<-function(x){1/(1+exp(-x))}
## now add year random slopes
poal_flow_mod5<- glmer(flw_count_t>0~endo_01*log(size_t)+(endo_01|year_t),family="binomial", data=poaals)
ranef(poal_flow_mod5)
coef(poal_flow_mod5)$year_t
plot(poaals$year_t,jitter(as.integer(poaals$flw_count_t>0),amount=0.02))
flow_mod5_Eminus_intercepts<-coef(poal_flow_mod5)$year_t[,1]
flow_mod5_Eminus_slopes<-coef(poal_flow_mod5)$year_t[,3]
flow_mod5_Eplus_intercepts<-coef(poal_flow_mod5)$year_t[,1]+coef(poal_flow_mod5)$year_t[,2]
flow_mod5_Eplus_slopes<-coef(poal_flow_mod5)$year_t[,3]+coef(poal_flow_mod5)$year_t[,4]
lines(x=x_yrs,y=logistic(flow_mod5_Eminus_slopes+flow_mod5_Eminus_intercepts), col="goldenrod", lty=2, type="b")
lines(x=x_yrs,y=logistic(flow_mod5_Eplus_intercepts+flow_mod5_Eplus_slopes), col="slateblue", lty=2, type="b")
summary(poal_flow_mod5)
##plotting flower count against year
plot(jitter(poaals$year_t, amount=0.35),jitter(poaals$flw_count_t, amount=0.035),
pch=21,
col= poaals$colorvar,
bg=alpha(poaals$coloUrvar, 0.2),
xlab = "year",
ylab = "# of flowering tillers",
main = "Effect of year on flower count",
cex=1.25)
legend("bottomright",legend=c("E+","E-"),
inset = c(0,0.17),
pch=21,
pt.cex=1,
cex=1,
col=c("slateblue4","goldenrod4"),
pt.bg=alpha(c("first" = "slateblue", "second" = "goldenrod"), 0.2))
##adding lines to the plot
#get model estimates for E- survival by year
flw_Eminus<-c(coef(flw_yrt_end)[1],coef(flw_yrt_end)[1]+coef(flw_yrt_end)[2:15])
names(flw_Eminus)<-x_yrs
#get model estimates for E+ survival by year
flw_Eplus<-c (coef(flw_yrt_end)[1] + coef(flw_yrt_end)[16], coef(flw_yrt_end)[1] +
coef(flw_yrt_end)[16] + coef(flw_yrt_end)[2:15] + coef(flw_yrt_end)[17:30])
names(flw_Eplus)<-x_yrs
#adding lines
lines(x=x_yrs, y=exp(flw_Eminus),col="goldenrod", lty=1, lwd=4, type="b")
lines(x=x_yrs, y=exp(flw_Eplus),col="slateblue", lty=1, lwd=4, type="b")
##fitting generalized linear model for effect of year and/or endophyte status on # of flowering tillers
(flw_yrt_end<-glm(flw_count_t~year_tf*endo_01, family="poisson",data=poaals))
summary(flw_yrt_end)
coef(flw_yrt_end)
##plotting flower count against year
plot(jitter(poaals$year_t, amount=0.35),jitter(poaals$flw_count_t, amount=0.035),
pch=21,
col= poaals$colorvar,
bg=alpha(poaals$coloUrvar, 0.2),
xlab = "year",
ylab = "# of flowering tillers",
main = "Effect of year on flower count",
cex=1.25)
legend("bottomright",legend=c("E+","E-"),
inset = c(0,0.17),
pch=21,
pt.cex=1,
cex=1,
col=c("slateblue4","goldenrod4"),
pt.bg=alpha(c("first" = "slateblue", "second" = "goldenrod"), 0.2))
##adding lines to the plot
#get model estimates for E- survival by year
flw_Eminus<-c(coef(flw_yrt_end)[1],coef(flw_yrt_end)[1]+coef(flw_yrt_end)[2:15])
names(flw_Eminus)<-x_yrs
#get model estimates for E+ survival by year
flw_Eplus<-c (coef(flw_yrt_end)[1] + coef(flw_yrt_end)[16], coef(flw_yrt_end)[1] +
coef(flw_yrt_end)[16] + coef(flw_yrt_end)[2:15] + coef(flw_yrt_end)[17:30])
names(flw_Eplus)<-x_yrs
#adding lines
lines(x=x_yrs, y=exp(flw_Eminus),col="goldenrod", lty=1, lwd=4, type="b")
lines(x=x_yrs, y=exp(flw_Eplus),col="slateblue", lty=1, lwd=4, type="b")
plot(poaals$year_t,jitter(as.integer(poaals$flw_count_t>0),amount=0.02))
flow_mod5_Eminus_intercepts<-coef(poal_flow_mod5)$year_t[,1]
flow_mod5_Eminus_slopes<-coef(poal_flow_mod5)$year_t[,3]
flow_mod5_Eplus_intercepts<-coef(poal_flow_mod5)$year_t[,1]+coef(poal_flow_mod5)$year_t[,2]
flow_mod5_Eplus_slopes<-coef(poal_flow_mod5)$year_t[,3]+coef(poal_flow_mod5)$year_t[,4]
lines(x=x_yrs,y=logistic(flow_mod5_Eminus_slopes+flow_mod5_Eminus_intercepts), col="goldenrod", lty=2, type="b")
lines(x=x_yrs,y=logistic(flow_mod5_Eplus_intercepts+flow_mod5_Eplus_slopes), col="slateblue", lty=2, type="b")
coef(poal_flow_mod5)$year_t
plot(poaals$year_t,jitter(as.integer(poaals$flw_count_t>0),amount=0.02))
flow_mod5_Eminus_intercepts<-coef(poal_flow_mod5)$year_t[,1]
flow_mod5_Eminus_slopes<-coef(poal_flow_mod5)$year_t[,3]
flow_mod5_Eplus_intercepts<-coef(poal_flow_mod5)$year_t[,1]+coef(poal_flow_mod5)$year_t[,2]
lines(x=x_yrs,y=logistic(flow_mod5_Eminus_intercepts), col="goldenrod", lty=2, type="b")
lines(x=x_yrs,y=logistic(flow_mod5_Eplus_intercepts), col="slateblue", lty=2, type="b")
?scale
##Tom adding standardization of size variable
hist(log(poaals$size_t))
hist(scale(log(poaals$size_t),center=T,scale=F))
hist(scale(log(poaals$size_t),center=T,scale=T))
hist(scale(log(poaals$size_t),center=T,scale=F))
poaals$log_tillers_centered <- log(poaals$size_t) - mean(log(poaals$size_t),na.rm=T)
hist(poaals$log_tillers_centered)
hist(scale(log(poaals$size_t),center=T,scale=F))
mean(log(poaals$size_t),na.rm=T)
mean(poaals$log_tillers_centered)
mean(poaals$log_tillers_centered,na.rm=T)
## now refit model
poal_flow_mod6<- glmer(flw_count_t>0~endo_01*log_tillers_centered+(endo_01|year_t),family="binomial", data=poaals)
flow_mod6_Eminus_intercepts<-coef(poal_flow_mod5)$year_t[,1]
flow_mod6_Eplus_intercepts<-coef(poal_flow_mod5)$year_t[,1]+coef(poal_flow_mod5)$year_t[,2]
plot(poaals$year_t,jitter(as.integer(poaals$flw_count_t>0),amount=0.02))
lines(x=x_yrs,y=logistic(flow_mod6_Eminus_intercepts), col="goldenrod", lty=2, type="b")
lines(x=x_yrs,y=logistic(flow_mod6_Eplus_intercepts), col="slateblue", lty=2, type="b")
poaals$log_tillers_centered <- log(poaals$size_t) - median(log(poaals$size_t),na.rm=T)
##equivaently:
hist(scale(log(poaals$size_t),center=T,scale=F))
poaals$log_tillers_centered <- log(poaals$size_t) - median(log(poaals$size_t),na.rm=T)
## now refit model
poal_flow_mod6<- glmer(flw_count_t>0~endo_01*log_tillers_centered+(endo_01|year_t),family="binomial", data=poaals)
flow_mod6_Eminus_intercepts<-coef(poal_flow_mod5)$year_t[,1]
flow_mod6_Eplus_intercepts<-coef(poal_flow_mod5)$year_t[,1]+coef(poal_flow_mod5)$year_t[,2]
lines(x=x_yrs,y=logistic(flow_mod6_Eminus_intercepts), col="goldenrod", lty=2, type="b")
lines(x=x_yrs,y=logistic(flow_mod6_Eplus_intercepts), col="slateblue", lty=2, type="b")
plot(poaals$year_t,jitter(as.integer(poaals$flw_count_t>0),amount=0.02))
lines(x=x_yrs,y=logistic(flow_mod6_Eminus_intercepts), col="goldenrod", lty=2, type="b")
lines(x=x_yrs,y=logistic(flow_mod6_Eplus_intercepts), col="slateblue", lty=2, type="b")
poaals$log_tillers_centered <- log(poaals$size_t) - mean(log(poaals$size_t),na.rm=T)
plot(x=x_yrs,y=logistic(flow_mod6_Eminus_intercepts), col="goldenrod", lty=2, type="b")
lines(x=x_yrs,y=logistic(flow_mod6_Eplus_intercepts), col="slateblue", lty=2, type="b")
coef(poal_flow_mod5)$year_t
#Important packages
library(tidyverse)
library(lme4)
library(rstan)
library(googlesheets4)
library(bayesplot)
options(mc.cores = parallel::detectCores())
#setwd("G:/.shortcut-targets-by-id/1o66WMnQligL0_-ahkQMfFOklR3X-6vOA/Akiem PhD Research/Data & Analysis")
setwd("/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage")
compcoe <- read.csv("/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage/data/ltreb_allspp_2007_2025.csv")
##Species filter
poaals <- compcoe %>% filter(species == "POAL")
poaals$log_tillers_centered <- log(poaals$size_t) - mean(log(poaals$size_t),na.rm=T)
##prep data, dropping NAs
poaals %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> poaals_flow
poal_flow_dat <- list(n_obs=nrow(poaals_flow),
y=poaals_flow$flw_count_t>0,
n_yrs = length(unique(poaals_flow$year_t)),
n_plots = max(poaals_flow$plot),
n_endo = 2,
endo_01=poaals_flow$endo_01,
size=poaals_flow$log_tillers_centered,
year_index=poaals_flow$year_t-2006,
plot=poaals_flow$plot)
poal_flow_model = stan_model(file="/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage/code/flowering.stan")
poal_flow_sampling<-sampling(poal_flow_model,
data=poal_flow_dat,
chains = 3,
iter = 5000,
warmup = 1000)
#Something is being done
params_poal_f<-rstan::extract(poal_flow_sampling,pars=c('beta_0','endo_effect'))
dim(params_poal_f$beta_0)
#take a random subset of posterior draws
poal_endoeffect_postf<-params_poal_f$endo_effect[sample(12000,size=500,replace=F),]
dim(poal_endoeffect_postf)
# Convert to long data frame
long_df_poal_f <- as.data.frame.table(poal_endoeffect_postf,
responseName = "value") %>%
rename(draw = iterations, year = Var2) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006)
summary_df_poal_f <- long_df_poal_f %>%
group_by(year) %>%
summarize(
median = median(value),
lower = quantile(value, 0.05),
upper = quantile(value, 0.95),
probgzero = mean(value>0),
.groups = "drop")
poaals %>%
select(surv_t1,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> poaals_surv
poal_surv_dat<-list(n_obs=nrow(poaals_surv),
y=poaals_surv$surv_t1,
n_yrs = length(unique(poaals_surv$year_t)),
n_plots = max(poaals_surv$plot),
n_endo = 2,
endo_01=poaals_surv$endo_01,
size=poaals_surv$log_tillers_centered,
year_index=poaals_surv$year_t-2006,
plot=poaals_surv$plot)
poal_surv_model = stan_model(file="/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage/code/flowering.stan")
poal_surv_sampling<-sampling(poal_surv_model,
data=poal_surv_dat,
chains = 3,
iter = 8000,
warmup = 2000)
#Something is being done
params_poal_s<-rstan::extract(poal_surv_sampling,pars=c('beta_0','endo_effect'))
dim(params_poal_s$beta_0)
#take a random subset of posterior draws
poal_endoeffect_posts<-params_poal_s$endo_effect[sample(12000,size=500,replace=F),]
dim(poal_endoeffect_posts)
# Convert to long data frame
long_df_poal_s <- as.data.frame.table(poal_endoeffect_posts,
responseName = "value") %>%
rename(draw = iterations, year = Var2) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006)
summary_df_poal_s <- long_df_poal_s %>%
group_by(year) %>%
summarize(median = median(value),
lower = quantile(value, 0.05),
upper = quantile(value, 0.95),
probgzero = mean(value>0),
.groups = "drop")
# plot
ggplot(summary_df_poal_s, aes(x = year, y = median)) +
geom_line(linewidth = 1.2) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
labs(x = "Year", y = "Endophyte effect",
title = "POAL: Difference of E+ and E- survival with year") +
geom_hline(yintercept = 0) +
theme_minimal()
##Species filter
poasyl <- compcoe %>% filter(species == "POSY")
poasyl$log_tillers_centered <- log(poasyl$size_t) - mean(log(poasyl$size_t),na.rm=T)
poasyl %>%
select(surv_t1,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> poasyl_surv
posy_surv_dat<-list(n_obs=nrow(poasyl_surv),
y=poasyl_surv$surv_t1,
n_yrs = length(unique(poasyl_surv$year_t)),
n_plots = max(poasyl_surv$plot),
n_endo = 2,
endo_01=poasyl_surv$endo_01,
size=poasyl_surv$log_tillers_centered,
year_index=poasyl_surv$year_t-2006,
plot=poasyl_surv$plot)
posy_surv_model = stan_model(file="/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage/code/flowering.stan")
posy_surv_sampling<-sampling(posy_surv_model,
data=posy_surv_dat,
chains = 3,
iter = 8000,
warmup = 2000)
#Something is being done
params_posy_s<-rstan::extract(posy_surv_sampling,pars=c('beta_0','endo_effect'))
dim(params_posy_s$beta_0)
#take a random subset of posterior draws
posy_endoeffect_posts<-params_posy_s$endo_effect[sample(12000,size=500,replace=F),]
dim(posy_endoeffect_posts)
# Convert to long data frame
long_df_posy_s <- as.data.frame.table(posy_endoeffect_posts,
responseName = "value") %>%
rename(draw = iterations, year = Var2) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006)
summary_df_posy_s <- long_df_posy_s %>%
group_by(year) %>%
summarize(median = median(value),
lower = quantile(value, 0.05),
upper = quantile(value, 0.95),
probgzero = mean(value>0),
.groups = "drop")
# plot
ggplot(summary_df_posy_s, aes(x = year, y = median)) +
geom_line(linewidth = 1.2) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
labs(x = "Year", y = "Endophyte effect",
title = "POSY: Difference of E+ and E- survival with year") +
geom_hline(yintercept = 0) +
theme_minimal()
##Species filter
agrper <- compcoe %>% filter(species == "AGPE")
agrper$log_tillers_centered <- log(agrper$size_t) - mean(log(agrper$size_t),na.rm=T)
##Species filter
elyvir <- compcoe %>% filter(species == "ELVI")
elyvir$log_tillers_centered <- log(elyvir$size_t) - mean(log(elyvir$size_t),na.rm=T)
elyvir %>%
select(surv_t1,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> elyvir_surv
elvi_surv_dat<-list(n_obs=nrow(elyvir_surv),
y=elyvir_surv$surv_t1,
n_yrs = length(unique(elyvir_surv$year_t)),
n_plots = max(elyvir_surv$plot),
n_endo = 2,
endo_01=elyvir_surv$endo_01,
size=elyvir_surv$log_tillers_centered,
year_index=elyvir_surv$year_t-2006,
plot=elyvir_surv$plot)
elvi_surv_model = stan_model(file="/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage/code/flowering.stan")
elvi_surv_sampling<-sampling(elvi_surv_model,
data=elvi_surv_dat,
chains = 3,
iter = 8000,
warmup = 2000)
#Something is being done
params_elvi_s<-rstan::extract(elvi_surv_sampling,pars=c('beta_0','endo_effect'))
dim(params_elvi_s$beta_0)
#take a random subset of posterior draws
elvi_endoeffect_posts<-params_elvi_s$endo_effect[sample(12000,size=500,replace=F),]
dim(elvi_endoeffect_posts)
# Convert to long data frame
long_df_elvi_s <- as.data.frame.table(elvi_endoeffect_posts,
responseName = "value") %>%
rename(draw = iterations, year = Var2) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006)
summary_df_elvi_s <- long_df_elvi_s %>%
group_by(year) %>%
summarize(median = median(value),
lower = quantile(value, 0.05),
upper = quantile(value, 0.95),
probgzero = mean(value>0),
.groups = "drop")
# plot
ggplot(summary_df_elvi_s, aes(x = year, y = median)) +
geom_line(linewidth = 1.2) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
labs(x = "Year", y = "Endophyte effect",
title = "ELVI: Difference of E+ and E- survival with year") +
geom_hline(yintercept = 0) +
theme_minimal()
elyvil %>%
select(surv_t1,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> elyvil_surv
##Species filter
elyvil <- compcoe %>% filter(species == "ELRI")
elyvil$log_tillers_centered <- log(elyvil$size_t) - mean(log(elyvil$size_t),na.rm=T)
elyvil %>%
select(surv_t1,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> elyvil_surv
elri_surv_dat<-list(n_obs=nrow(elyvil_surv),
y=elyvil_surv$surv_t1,
n_yrs = length(unique(elyvil_surv$year_t)),
n_plots = max(elyvil_surv$plot),
n_endo = 2,
endo_01=elyvil_surv$endo_01,
size=elyvil_surv$log_tillers_centered,
year_index=elyvil_surv$year_t-2006,
plot=elyvil_surv$plot)
elri_surv_model = stan_model(file="/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage/code/flowering.stan")
elri_surv_sampling<-sampling(elri_surv_model,
data=elri_surv_dat,
chains = 3,
iter = 8000,
warmup = 2000)
#Something is being done
params_elri_s<-rstan::extract(elri_surv_sampling,pars=c('beta_0','endo_effect'))
dim(params_elri_s$beta_0)
#take a random subset of posterior draws
elri_endoeffect_posts<-params_elri_s$endo_effect[sample(12000,size=500,replace=F),]
dim(elri_endoeffect_posts)
# Convert to long data frame
long_df_elri_s <- as.data.frame.table(elri_endoeffect_posts,
responseName = "value") %>%
rename(draw = iterations, year = Var2) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006)
summary_df_elri_s <- long_df_elri_s %>%
group_by(year) %>%
summarize(median = median(value),
lower = quantile(value, 0.05),
upper = quantile(value, 0.95),
probgzero = mean(value>0),
.groups = "drop")
# plot
ggplot(summary_df_elri_s, aes(x = year, y = median)) +
geom_line(linewidth = 1.2) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
labs(x = "Year", y = "Endophyte effect",
title = "ELRI: Difference of E+ and E- survival with year") +
geom_hline(yintercept = 0) +
theme_minimal()
##Species filter
fessub <- compcoe %>% filter(species == "FESU")
fessub$log_tillers_centered <- log(fessub$size_t) - mean(log(fessub$size_t),na.rm=T)
fessub %>%
select(surv_t1,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> fessub_surv
fesu_surv_dat<-list(n_obs=nrow(fessub_surv),
y=fessub_surv$surv_t1,
n_yrs = length(unique(fessub_surv$year_t)),
n_plots = max(fessub_surv$plot),
n_endo = 2,
endo_01=fessub_surv$endo_01,
size=fessub_surv$log_tillers_centered,
year_index=fessub_surv$year_t-2006,
plot=fessub_surv$plot)
fesu_surv_model = stan_model(file="/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage/code/flowering.stan")
fesu_surv_sampling<-sampling(fesu_surv_model,
data=fesu_surv_dat,
chains = 3,
iter = 8000,
warmup = 2000)
#Something is being done
params_fesu_s<-rstan::extract(fesu_surv_sampling,pars=c('beta_0','endo_effect'))
dim(params_fesu_s$beta_0)
#take a random subset of posterior draws
fesu_endoeffect_posts<-params_fesu_s$endo_effect[sample(12000,size=500,replace=F),]
dim(fesu_endoeffect_posts)
# Convert to long data frame
long_df_fesu_s <- as.data.frame.table(fesu_endoeffect_posts,
responseName = "value") %>%
rename(draw = iterations, year = Var2) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006)
summary_df_fesu_s <- long_df_fesu_s %>%
group_by(year) %>%
summarize(median = median(value),
lower = quantile(value, 0.05),
upper = quantile(value, 0.95),
probgzero = mean(value>0),
.groups = "drop")
# plot
ggplot(summary_df_fesu_s, aes(x = year, y = median)) +
geom_line(linewidth = 1.2) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
labs(x = "Year", y = "Endophyte effect",
title = "FESU: Difference of E+ and E- survival with year") +
geom_hline(yintercept = 0) +
theme_minimal()
