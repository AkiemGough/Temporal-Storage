library(scales)
library(DHARMa)
library(car)
#reading in downloaded weather data
weather <- read_csv("data/weather_data.csv")
#generating summary stats for each census year
weatherMay <- weather %>%
group_by(
CensusYearMay) %>%
mutate(CensusYearMay_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearMay_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearMay_tmean_mean = mean(`tmean (degrees F)`, na.rm = TRUE), #change to average
CensusYearMay_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
weatherJun <- weather %>%
group_by(
CensusYearJun) %>%
mutate(CensusYearJun_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearJun_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearJun_tmean_mean = mean(`tmean (degrees F)`, na.rm = TRUE),
CensusYearJun_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
library(devtools)
library(remotes)
library(prism)
library(dplyr)
library(tidyr)
#library(terra) #AKIEM - doesn't seem to work or use raster
library(lubridate)
library(tidyverse)
library(dplyr)
library(lme4)
library(AICcmodavg)
library(scales)
library(DHARMa)
library(car)
#reading in downloaded weather data
weather <- read_csv("data/weather_data.csv")
#extracting month and year from date
weather$Date <- as.Date(weather$Date, format= "%m/%d/%Y")
weather$monthina <- as.numeric (format(weather$Date, "%m"))
weather$yearina <- as.numeric (format(weather$Date, "%Y")) + 2000
#creating census years for each data collection period
weather$CensusYearMay <- ifelse(weather$monthina >= 5, (weather$yearina + 1), weather$yearina)
weather$CensusYearJun <- ifelse(weather$monthina >= 6, (weather$yearina + 1), weather$yearina)
weather$CensusYearJul <- ifelse(weather$monthina >= 7, (weather$yearina + 1), weather$yearina)
weather$CensusYearSep <- ifelse(weather$monthina >= 9, (weather$yearina + 1), weather$yearina)
#generating summary stats for each census year
weatherMay <- weather %>%
group_by(
CensusYearMay) %>%
mutate(CensusYearMay_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearMay_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearMay_tmean_mean = mean(`tmean (degrees F)`, na.rm = TRUE), #change to average
CensusYearMay_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
weatherJun <- weather %>%
group_by(
CensusYearJun) %>%
mutate(CensusYearJun_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearJun_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearJun_tmean_mean = mean(`tmean (degrees F)`, na.rm = TRUE),
CensusYearJun_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
weatherJul <- weather %>%
group_by(
CensusYearJul) %>%
mutate(CensusYearJul_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearJul_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearJul_tmean_mean = mean(`tmean (degrees F)`, na.rm = TRUE),
CensusYearJul_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
weatherSep <- weather %>%
group_by(
CensusYearSep) %>%
mutate(CensusYearSep_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearSep_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearSep_tmean_mean = mean(`tmean (degrees F)`, na.rm = TRUE),
CensusYearSep_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
#making data frames with only necessary data for each census year
weatherMay <- weatherMay %>%
select(-`tmax (degrees F)`,-`tdmean (degrees F)`,-`vpdmin (hPa)`,-`vpdmax (hPa)`,-`tmin (degrees F)`,
-Date, -monthina, -yearina, -`ppt (inches)`,-`tmean (degrees F)`,
-CensusYearJun, -CensusYearJul, -CensusYearSep) %>%
distinct()
weatherJun <- weatherJun %>%
select(-`tmax (degrees F)`,-`tdmean (degrees F)`,-`vpdmin (hPa)`,-`vpdmax (hPa)`,-`tmin (degrees F)`,
-Date, -monthina, -yearina, -`ppt (inches)`,-`tmean (degrees F)`,
-CensusYearMay, -CensusYearJul, -CensusYearSep) %>%
distinct()
weatherJul <- weatherJul %>%
select(-`tmax (degrees F)`,-`tdmean (degrees F)`,-`vpdmin (hPa)`,-`vpdmax (hPa)`,-`tmin (degrees F)`,
-Date, -monthina, -yearina, -`ppt (inches)`,-`tmean (degrees F)`,
-CensusYearMay, -CensusYearJun, -CensusYearSep) %>%
distinct()
weatherSep <- weatherSep %>%
select(-`tmax (degrees F)`,-`tdmean (degrees F)`,-`vpdmin (hPa)`,-`vpdmax (hPa)`,-`tmin (degrees F)`,
-Date, -monthina, -yearina, -`ppt (inches)`,-`tmean (degrees F)`,
-CensusYearJun, -CensusYearJul, -CensusYearMay) %>%
distinct()
#Combining demographic data with the weather data
gras <- read.csv("data/ltreb_allspp_2007_2025.csv")
CombinedMay <- left_join(x=gras, y=weatherMay, by=c("year_t" = "CensusYearMay")) %>%
rowwise()
CombinedJun <- left_join(x=CombinedMay, y=weatherJun, by=c("year_t" = "CensusYearJun")) %>%
rowwise()
CombinedJul <- left_join(x=CombinedJun, y=weatherJul, by=c("year_t" = "CensusYearJul")) %>%
rowwise()
CombinedData <- left_join(x=CombinedJul, y=weatherSep, by=c("year_t" = "CensusYearSep")) %>%
rowwise()
CombinedData$ppt_tot <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_ppt_tot,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "FESU" ~ CombinedData$CensusYearJun_ppt_tot,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "POAL" ~ CombinedData$CensusYearMay_ppt_tot,
gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_tot, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_tot))
CombinedData$ppt_sd <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_ppt_sd,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "FESU" ~ CombinedData$CensusYearJun_ppt_sd,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "POAL" ~ CombinedData$CensusYearMay_ppt_sd,
gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_sd, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_sd))
CombinedData$tmean_mean <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_tmean_mean,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_tmean_mean,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_tmean_mean,
gras$species == "FESU" ~ CombinedData$CensusYearJun_tmean_mean,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_tmean_mean, #fake
gras$species == "POAL" ~ CombinedData$CensusYearMay_tmean_mean,
gras$species == "POAU" ~ CombinedData$CensusYearMay_tmean_mean, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_tmean_mean))
CombinedData$tmean_sd <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_tmean_sd,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_tmean_sd,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_tmean_sd,
gras$species == "FESU" ~ CombinedData$CensusYearJun_tmean_sd,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_tmean_sd,
gras$species == "POAL" ~ CombinedData$CensusYearMay_tmean_sd,
gras$species == "POAU" ~ CombinedData$CensusYearMay_tmean_sd, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_tmean_sd))
str(CombinedData)
CombinedDataRefined <- CombinedData %>% select(X, species, plot, endo_01, id, origin, original, birth,
year_t, age, size_t, flw_count_t, mean_spike_t,
year_t1, surv_t1, size_t1, flw_count_t1, mean_spike_t1,
dist_a, dist_b, ppt_tot, ppt_sd, tmean_mean, tmean_sd)
write.csv(CombinedDataRefined, "data/CombinedDataRefined")
grasclim <-read.csv("data/CombinedDataRefined")
##Species filter
poaals_c <- grasclim %>% filter(species == "POAL")
poaals_c$log_tillers_centered <- log(poaals_c$size_t) - mean(log(poaals_c$size_t),na.rm=T)
##prep data for total precipitation, dropping NAs
poaals_c %>%
select(flw_count_t,endo_01,log_tillers_centered,plot,year_t,ppt_tot,ppt_sd) %>%
drop_na() -> poaals_flow_c
View(gras$species == "AGPE")
View(filter(gras$species == "AGPE"))
View(agrostisper <- filter(gras$species == "AGPE"))
View(gras %>% filter(species == "AGPE"))
grasclim <-read.csv("data/CombinedDataRefined")
##Species filter
poaals_c <- grasclim %>% filter(species == "POAL")
poaals_c$log_tillers_centered <- log(poaals_c$size_t) - mean(log(poaals_c$size_t),na.rm=T)
##prep data for total precipitation, dropping NAs
poaals_c %>%
select(flw_count_t,endo_01,log_tillers_centered,plot,year_t,ppt_tot,ppt_sd) %>%
drop_na() -> poaals_flow_c
##prep data for total precipitation, dropping NAs
poaals_c %>%
select(flw_count_t,endo_01,log_tillers_centered,plot,year_t,ppt_tot,ppt_sd) %>%
drop_na() -> poaals_flow_c
poal_surv_dat<-list(n_obs=nrow(poaals_flow_c),
y=poaals_flow_c$flw_count_t>0, # should this be flw_count_t1?
n_yrs = length(unique(poaals_flow_c$year_t)),
n_plots = max(poaals_flow_c$plot),
n_endo = 2,
endo_01=poaals_flow_c$endo_01,
size=poaals_flow_c$log_tillers_centered,
year_index=poaals_flow_c$year_t-2006,
climate=poaals_flow_c$ppt_tot,
plot=poaals_flow_c$plot)
poal_flow_model_c = stan_model(file="code/earlier_climatedemo.stan")
#Important packages
library(tidyverse)
library(lme4)
library(rstan)
library(googlesheets4)
library(bayesplot)
options(mc.cores = parallel::detectCores())
gras <- read.csv("data/ltreb_allspp_2007_2025.csv")
grasclim <-read.csv("data/CombinedDataRefined")
##Species filter
poaals_c <- grasclim %>% filter(species == "POAL")
poaals_c$log_tillers_centered <- log(poaals_c$size_t) - mean(log(poaals_c$size_t),na.rm=T)
poaals_c$log_ppt_tot_centered <- log(poaals_c$ppt_tot) - mean(log(poaals_c$ppt_tot),na.rm=T)
##prep data for total precipitation, dropping NAs
poaals_c %>%
select(flw_count_t,endo_01,log_tillers_centered,log_ppt_tot_centered,plot,year_t) %>%
drop_na() -> poaals_flow_c
poal_surv_dat<-list(n_obs=nrow(poaals_flow_c),
y=poaals_flow_c$flw_count_t>0, # should this be flw_count_t1?
n_yrs = length(unique(poaals_flow_c$year_t)),
n_plots = max(poaals_flow_c$plot),
n_endo = 2,
endo_01=poaals_flow_c$endo_01,
size=poaals_flow_c$log_tillers_centered,
year_index=poaals_flow_c$year_t-2006,
climate=poaals_flow_c$log_ppt_tot_centered, #center climate the way we centred size, there is also a scale fucnction you could use
plot=poaals_flow_c$plot)
poal_flow_model_c = stan_model(file="code/earlier_climatedemo.stan")
poal_flow_model_c = stan_model(file="code/earlier_climatedemo.stan")
poal_flow_model_c = stan_model(file="code/earlier_climatedemo.stan")
poal_flow_model_c = stan_model(file="code/earlier_climatedemo.stan")
##Species filter
#agrper <- gras %>% filter(species == "AGPE" & year_t1 < 2022)
agrper <- gras %>% filter(species == "AGPE")
agrper$log_tillers_centered <- log(agrper$size_t) - mean(log(agrper$size_t),na.rm=T)
##prep data, dropping NAs
agrper %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> agrper_flow
agpe_flow_dat <- list(n_obs=nrow(agrper_flow),
y=agrper_flow$flw_count_t>0,
n_yrs = length(unique(agrper_flow$year_t)),
n_plots = max(agrper_flow$plot),
n_endo = 2,
endo_01=agrper_flow$endo_01,
size=agrper_flow$log_tillers_centered,
year_index=agrper_flow$year_t-2006,
plot=agrper_flow$plot)
agpe_flow_model = stan_model(file="code/earlier_flowering.stan")
agpe_flow_sampling<-sampling(agpe_flow_model,
data=agpe_flow_dat,
chains = 1, #following prompt to check when only 1 chain
iter = 5000,
warmup = 1000)
agpe_flow_dat$n_obs
agpe_flow_dat$n_plots
agpe_flow_dat$year_index
agpe_flow_dat$n_yrs
unique(agpe_flow_dat$year_index)
##Species filter
poasyl <- gras %>% filter(species == "POSY")
poasyl$log_tillers_centered <- log(poasyl$size_t) - mean(log(poasyl$size_t),na.rm=T)
##prep data, dropping NAs
poasyl %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> poasyl_flow
posy_flow_dat <- list(n_obs=nrow(poasyl_flow),
y=poasyl_flow$flw_count_t>0,
n_yrs = length(unique(poasyl_flow$year_t)),
n_plots = max(poasyl_flow$plot),
n_endo = 2,
endo_01=poasyl_flow$endo_01,
size=poasyl_flow$log_tillers_centered,
year_index=poasyl_flow$year_t-2006,
plot=poasyl_flow$plot)
posy_flow_model = stan_model(file="/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage/code/earlier_flowering.stan")
unique(posy_flow_dat$year_index)
length(unique(agrper_surv$year_t))
agrper %>%
select(surv_t1,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> agrper_surv
agpe_surv_dat<-list(n_obs=nrow(agrper_surv),
y=agrper_surv$surv_t1,
n_yrs = length(unique(agrper_surv$year_t)),
n_plots = max(agrper_surv$plot),
n_endo = 2,
endo_01=agrper_surv$endo_01,
size=agrper_surv$log_tillers_centered,
year_index=agrper_surv$year_t-2006,
plot=agrper_surv$plot)
length(unique(agrper_surv$year_t))
length(unique(agrper_flow$year_t))
unique(agrper_flow$year_t-2006)
agrper_flow %>%
select(year_t) %>% mutate(year_index=year_t-2006) %>% distinct()
agrper_flow %>%
filter(year_t==2022)
source("~/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage/code/BAYE_TIME_NOV1.R")
#Important packages
library(tidyverse)
library(lme4)
library(rstan)
library(googlesheets4)
library(bayesplot)
options(mc.cores = parallel::detectCores())
#Important packages
library(tidyverse)
library(lme4)
library(rstan)
library(googlesheets4)
library(bayesplot)
options(mc.cores = parallel::detectCores())
gras <- read.csv("data/ltreb_allspp_2007_2025.csv")
##Species filter
#agrper <- gras %>% filter(species == "AGPE" & year_t1 < 2022)
agrper <- gras %>% filter(species == "AGPE")
agrper$log_tillers_centered <- log(agrper$size_t) - mean(log(agrper$size_t),na.rm=T)
##prep data, dropping NAs
agrper %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> agrper_flow
agpe_flow_dat <- list(n_obs=nrow(agrper_flow),
y=agrper_flow$flw_count_t>0,
n_yrs = length(unique(agrper_flow$year_t))+1,
n_plots = max(agrper_flow$plot),
n_endo = 2,
endo_01=agrper_flow$endo_01,
size=agrper_flow$log_tillers_centered,
year_index=agrper_flow$year_t-2006,
plot=agrper_flow$plot)
agpe_flow_model = stan_model(file="code/earlier_flowering.stan")
agpe_flow_sampling<-sampling(agpe_flow_model,
data=agpe_flow_dat,
chains = 1, #following prompt to check when only 1 chain
iter = 5000,
warmup = 1000)
agpe_flow_sampling<-sampling(agpe_flow_model,
data=agpe_flow_dat,
chains = 3, #following prompt to check when only 1 chain
iter = 5000,
warmup = 1000)
#pulling the posterior draws
params_agpe_f<-rstan::extract(agpe_flow_sampling,pars=c('beta_0','endo_effect'))
dim(params_agpe_f$beta_0)
#take a random subset of posterior draws
agpe_endoeffect_postf<-params_agpe_f$endo_effect[sample(12000,size=500,replace=F),]
dim(agpe_endoeffect_postf)
# Convert to long data frame
long_df_agpe_f <- as.data.frame.table(agpe_endoeffect_postf,
responseName = "value") %>%
rename(draw = iterations, year = Var2) %>%
mutate(
draw = as.integer(draw),
year = as.integer(year)+2006)
summary_df_agpe_f <- long_df_agpe_f %>%
group_by(year) %>%
summarize(
median = median(value),
lower = quantile(value, 0.05),
upper = quantile(value, 0.95),
probgzero = mean(value>0),
.groups = "drop")
#plot
ggplot(summary_df_agpe_f, aes(x = year, y = median)) +
geom_line(linewidth = 1.2) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
labs(
x = "Year", y = "Endophyte effect",
title = "AGPE: Difference of E+ and E- flowering prob with year") +
geom_hline(yintercept = 0) +
theme_minimal()
##prep data for total precipitation, dropping NAs
poaals_c %>%
select(flw_count_t,endo_01,log_tillers_centered,log_ppt_tot_centered,plot,year_t) %>%
drop_na() -> poaals_flow_c
grasclim <-read.csv("data/CombinedDataRefined")
##Species filter
poaals_c <- grasclim %>% filter(species == "POAL")
##Species filter
poaals_c <- grasclim %>% filter(species == "POAL")
poaals_c$log_tillers_centered <- log(poaals_c$size_t) - mean(log(poaals_c$size_t),na.rm=T)
poaals_c$log_ppt_tot_centered <- log(poaals_c$ppt_tot) - mean(log(poaals_c$ppt_tot),na.rm=T)
##prep data for total precipitation, dropping NAs
poaals_c %>%
select(flw_count_t,endo_01,log_tillers_centered,log_ppt_tot_centered,plot,year_t) %>%
drop_na() -> poaals_flow_c
poal_surv_dat<-list(n_obs=nrow(poaals_flow_c),
y=poaals_flow_c$flw_count_t>0, # should this be flw_count_t1?
n_yrs = length(unique(poaals_flow_c$year_t))+1,
n_plots = max(poaals_flow_c$plot),
n_endo = 2,
endo_01=poaals_flow_c$endo_01,
size=poaals_flow_c$log_tillers_centered,
year_index=poaals_flow_c$year_t-2006,
climate=poaals_flow_c$log_ppt_tot_centered, #center climate the way we centred size, there is also a scale fucnction you could use
plot=poaals_flow_c$plot)
poal_flow_model_c = stan_model(file="code/earlier_climatedemo.stan")
poal_flow_sampling_c<-sampling(poal_flow_model_c,
data=poal_flow_dat_c,
chains = 3,
iter = 5000,
warmup = 1000)
##prep data for total precipitation, dropping NAs
poaals_c %>%
select(flw_count_t,endo_01,log_tillers_centered,log_ppt_tot_centered,plot,year_t) %>%
drop_na() -> poaals_flow_c
poal_flow_dat_c<-list(n_obs=nrow(poaals_flow_c),
y=poaals_flow_c$flw_count_t>0, # should this be flw_count_t1?
n_yrs = length(unique(poaals_flow_c$year_t))+1,
n_plots = max(poaals_flow_c$plot),
n_endo = 2,
endo_01=poaals_flow_c$endo_01,
size=poaals_flow_c$log_tillers_centered,
year_index=poaals_flow_c$year_t-2006,
climate=poaals_flow_c$log_ppt_tot_centered, #center climate the way we centred size, there is also a scale fucnction you could use
plot=poaals_flow_c$plot)
poal_flow_model_c = stan_model(file="code/earlier_climatedemo.stan")
poal_flow_sampling_c<-sampling(poal_flow_model_c,
data=poal_flow_dat_c,
chains = 3,
iter = 5000,
warmup = 1000)
params_poal_f_c<-rstan::extract(poal_flow_sampling_c,pars=c('beta_0','endo_effect'))
poal_flow_sampling_c<-sampling(poal_flow_model_c,
data=poal_flow_dat_c,
chains = 1,
iter = 5000,
warmup = 1000)
params_poal_f_c<-rstan::extract(poal_flow_sampling_c,pars=c('beta_0','endo_effect'))
##prep data for total precipitation, dropping NAs
poaals_c %>%
select(flw_count_t,endo_01,log_tillers_centered,log_ppt_tot_centered,plot,year_t) %>%
drop_na() -> poaals_flow_c
poal_flow_dat_c<-list(n_obs=nrow(poaals_flow_c),
y=poaals_flow_c$flw_count_t>0, # should this be flw_count_t1?
n_yrs = length(unique(poaals_flow_c$year_t))+1,
n_plots = max(poaals_flow_c$plot),
n_endo = 2,
endo_01=poaals_flow_c$endo_01,
size=poaals_flow_c$log_tillers_centered,
year_index=poaals_flow_c$year_t-2006,
climate=poaals_flow_c$log_ppt_tot_centered, #center climate the way we centred size, there is also a scale fucnction you could use
plot=poaals_flow_c$plot)
poal_flow_model_c = stan_model(file="code/earlier_climatedemo.stan")
poal_flow_sampling_c<-sampling(poal_flow_model_c,
data=poal_flow_dat_c,
chains = 3,
iter = 5000,
warmup = 1000)
params_poal_f_c<-rstan::extract(poal_flow_sampling_c,pars=c('beta_0','beta_endo',
'endophyte','beta_size',
'beta_clim','beta_size_endo',
'beta_clim_endo'))
params_poal_f_c<-rstan::extract(poal_flow_sampling_c,pars=c('beta_0','beta_endo',
'beta_size','beta_clim',
'beta_size_endo','beta_clim_endo'))
dim(params_poal_f_c$beta_0)
dim(params_agpe_f$beta_0)
##prep data, dropping NAs
gras %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot,spec,original) %>%
drop_na() -> all_flow
all_flow_dat <- list(n_obs=nrow(all_flow),
y=all_flow$flw_count_t>0,
n_yrs = length(unique(all_flow$year_t))+1,
n_plots = max(all_flow$plot),
n_endo = 2,
n_spp = length(unique(all_flow$spec)),
endo_01=all_flow$endo_01,
size=all_flow$log_tillers_centered,
year_index=all_flow$year_t-2006,
plot=all_flow$plot,
species=all_flow$spec,
original=all_flow$original)
all_flow_model = stan_model(file="code/flowering_mvn.stan")
##prep data, dropping NAs
gras %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot,spec,original) %>%
drop_na() -> all_flow
gras <- read.csv("data/ltreb_allspp_2007_2025.csv")
gras <- gras[!(gras$id=="79 1164 4"),]
##Making integers for species
gras$spec <- as.integer (case_when(gras$species == "AGPE" ~ 8,
gras$species == "ELRI" ~ 2,
gras$species == "ELVI" ~ 3,
gras$species == "FESU" ~ 4,
gras$species == "LOAR" ~ 5,
gras$species == "POAL" ~ 6,
gras$species == "POAU" ~ 7,
gras$species == "POSY" ~ 1))
##centering size
gras$log_tillers_centered <- log(gras$size_t) - mean(log(gras$size_t),na.rm=T)
##prep data, dropping NAs
gras %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot,spec,original) %>%
drop_na() -> all_flow
all_flow_dat <- list(n_obs=nrow(all_flow),
y=all_flow$flw_count_t>0,
n_yrs = length(unique(all_flow$year_t))+1,
n_plots = max(all_flow$plot),
n_endo = 2,
n_spp = length(unique(all_flow$spec)),
endo_01=all_flow$endo_01,
size=all_flow$log_tillers_centered,
year_index=all_flow$year_t-2006,
plot=all_flow$plot,
species=all_flow$spec,
original=all_flow$original)
all_flow_model = stan_model(file="code/flowering_mvn.stan")
#saveRDS(all_flow_sampling,"all_flow_sampling.rds")
all_flow_sampling<-readRDS("all_flow_sampling.rds")
dim(params_poal_f_c$beta_clim_endo)
poal_climendo_postf_c<-params_poal_f_c$beta_clim_endo[sample(dim(params_poal_f_c$beta_clim_endo)[1],size=1000,replace=F),]
dim(params_poal_f_c$beta_clim_endo)
dim(params_poal_f_c)
dim(params_poal_f_c$beta_size_endo)
poal_climendo_postf_c<-params_poal_f_c$beta_clim_endo[sample(dim(4000,size=1000,replace=F),]
poal_climendo_postf_c<-params_poal_f_c$beta_clim_endo[sample(4000,size=1000,replace=F),]
poal_climendo_postf_c<-params_poal_f_c$beta_clim_endo[sample(4000,size=1000,replace=F)]
dim(poal_climendo_postf_c)
as.data.frame.table(poal_climendo_postf_c)
long_df_poal_climendof_c <- as.data.frame.table(poal_climendo_postf_c,
responseName = "value")
as.data.frame.table(poal_climendo_postf_c,responseName = "value")
dim(params_poal_f_c$beta_clim)
poal_clim_postf_c<-params_poal_f_c$beta_clim[sample(4000,size=1000,replace=F)]
dim(poal_clim_postf_c)
as.data.frame.table(poal_clim_postf_c,responseName = "value")
#reading in the data file with demographic and climate data
grasclim <-read.csv("data/CombinedDataRefined")
##removing untrusted data
grasclim <- grasclim[!(grasclim$id=="79 1164 4"),]
unique(grasclim$id)
length(unique(grasclim$id))
