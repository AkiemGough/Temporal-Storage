gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_tot, #fake
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_tot,
.ptype = CombinedData$CensusYearSep_ppt_tot))
CombinedDataRefined <- CombinedData %>% select(X, species, plot, endo_01, id, origin, original, birth,
year_t, age, size_t, flw_count_t, mean_spike_t,
year_t1, surv_t1, size_t1, flw_count_t1, mean_spike_t1,
dist_a, dist_b, ppt_tot)
View(CombinedDataRefined)
CombinedData$ppt_tot <- as.integer (case_when(gras$species == "AGPE" ~ round(CombinedData$CensusYearSep_ppt_tot, digits = 7),
gras$species == "ELRI" ~ round(CombinedData$CensusYearJul_ppt_tot, digits = 7),
gras$species == "ELVI" ~ round(CombinedData$CensusYearJul_ppt_tot, digits = 7),
gras$species == "FESU" ~ round(CombinedData$CensusYearMay_ppt_tot, digits = 7),
gras$species == "LOAR" ~ round(CombinedData$CensusYearMay_ppt_tot, digits = 7),#fake
gras$species == "POAL" ~ round(CombinedData$CensusYearMay_ppt_tot, digits = 7),
gras$species == "POAU" ~ round(CombinedData$CensusYearMay_ppt_tot, digits = 7), #fake
gras$species == "POSY" ~ round(CombinedData$CensusYearMay_ppt_tot, digits = 7)))
CombinedDataRefined <- CombinedData %>% select(X, species, plot, endo_01, id, origin, original, birth,
year_t, age, size_t, flw_count_t, mean_spike_t,
year_t1, surv_t1, size_t1, flw_count_t1, mean_spike_t1,
dist_a, dist_b, ppt_tot)
View(CombinedDataRefined)
str(CombinedData)
CombinedData$ppt_tot <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_ppt_tot,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "FESU" ~ CombinedData$CensusYearMay_ppt_tot,
gras$species == "LOAR" ~ CombinedData$CensusYearMay_ppt_tot, #fake
gras$species == "POAL" ~ CombinedData$CensusYearMay_ppt_tot,
gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_tot, #fake
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_tot))
View(CombinedData$ppt_tot)
View(CombinedData)
CombinedDataRefined <- CombinedData %>% select(X, species, plot, endo_01, id, origin, original, birth,
year_t, age, size_t, flw_count_t, mean_spike_t,
year_t1, surv_t1, size_t1, flw_count_t1, mean_spike_t1,
dist_a, dist_b, ppt_tot)
View(CombinedDataRefined)
CombinedData$ppt_sd <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_ppt_sd,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "FESU" ~ CombinedData$CensusYearMay_ppt_sd,
gras$species == "LOAR" ~ CombinedData$CensusYearMay_ppt_sd, #fake
gras$species == "POAL" ~ CombinedData$CensusYearMay_ppt_sd,
gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_sd, #fake
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_sd))
CombinedDataRefined <- CombinedData %>% select(X, species, plot, endo_01, id, origin, original, birth,
year_t, age, size_t, flw_count_t, mean_spike_t,
year_t1, surv_t1, size_t1, flw_count_t1, mean_spike_t1,
dist_a, dist_b, ppt_tot, ppt_sd)
View(CombinedDataRefined)
CombinedData$ppt_tot <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_ppt_tot,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "FESU" ~ CombinedData$CensusYearMay_ppt_tot,
gras$species == "LOAR" ~ CombinedData$CensusYearMay_ppt_tot, #fake
gras$species == "POAL" ~ CombinedData$CensusYearMay_ppt_tot,
gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_tot, #fake
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_tot))
CombinedData$ppt_sd <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_ppt_sd,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "FESU" ~ CombinedData$CensusYearMay_ppt_sd,
gras$species == "LOAR" ~ CombinedData$CensusYearMay_ppt_sd, #fake
gras$species == "POAL" ~ CombinedData$CensusYearMay_ppt_sd,
gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_sd, #fake
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_sd))
CombinedData$tmean_mean <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_tmean_mean,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_tmean_mean,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_tmean_mean,
gras$species == "FESU" ~ CombinedData$CensusYearMay_tmean_mean,
gras$species == "LOAR" ~ CombinedData$CensusYearMay_tmean_mean, #fake
gras$species == "POAL" ~ CombinedData$CensusYearMay_tmean_mean,
gras$species == "POAU" ~ CombinedData$CensusYearMay_tmean_mean, #fake
gras$species == "POSY" ~ CombinedData$CensusYearMay_tmean_mean))
CombinedData$tmean_sd <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_tmean_sd,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_tmean_sd,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_tmean_sd,
gras$species == "FESU" ~ CombinedData$CensusYearMay_tmean_sd,
gras$species == "LOAR" ~ CombinedData$CensusYearMay_tmean_sd, #fake
gras$species == "POAL" ~ CombinedData$CensusYearMay_tmean_sd,
gras$species == "POAU" ~ CombinedData$CensusYearMay_tmean_sd, #fake
gras$species == "POSY" ~ CombinedData$CensusYearMay_tmean_sd))
CombinedDataRefined <- CombinedData %>% select(X, species, plot, endo_01, id, origin, original, birth,
year_t, age, size_t, flw_count_t, mean_spike_t,
year_t1, surv_t1, size_t1, flw_count_t1, mean_spike_t1,
dist_a, dist_b, ppt_tot, ppt_sd, tmean_mean, tmean_sd)
#Important packages
library(tidyverse)
#Important packages
library(tidyverse)
#Important packages
library(tidyverse)
library(lme4)
library(rstan)
library(googlesheets4)
library(bayesplot)
options(mc.cores = parallel::detectCores())
#setwd("G:/.shortcut-targets-by-id/1o66WMnQligL0_-ahkQMfFOklR3X-6vOA/Akiem PhD Research/Data & Analysis")
#setwd("/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage")
gras <- read.csv("data/ltreb_allspp_2007_2025.csv")
##Species filter
agrper <- gras %>% filter(species == "AGPE")
agrper$log_tillers_centered <- log(agrper$size_t) - mean(log(agrper$size_t),na.rm=T)
##prep data, dropping NAs
agrper %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> agrper_flow
agpe_flow_dat <- list(n_obs=nrow(agrper_flow),
y=agrper_flow$flw_count_t>0,
n_yrs = length(unique(agrper_flow$year_t)),
n_plots = max(agrper_flow$plot),
n_endo = 2,
endo_01=agrper_flow$endo_01,
size=agrper_flow$log_tillers_centered,
year_index=agrper_flow$year_t-2006,
plot=agrper_flow$plot)
agpe_flow_model = stan_model(file="code/earlier_flowering.stan")
agpe_flow_sampling<-sampling(agpe_flow_model,
data=agpe_flow_dat,
chains = 1, #following prompt to check when only 1 chain
iter = 5000,
warmup = 1000)
agpe_flow_model = stan_model(file="code/earlier_flowering.stan")
agpe_flow_model = stan_model(file="code/earlier_flowering.stan")
agpe_flow_sampling<-sampling(agpe_flow_model,
data=agpe_flow_dat,
chains = 1, #following prompt to check when only 1 chain
iter = 5000,
warmup = 1000)
library(devtools)
library(remotes)
library(prism)
library(dplyr)
library(tidyr)
#library(terra) #AKIEM - doesn't seem to work or use raster
library(lubridate)
library(tidyverse)
library(dplyr)
library(lme4)
library(AICcmodavg)
library(scales)
library(DHARMa)
library(car)
#reading in downloaded weather data
weather <- read_csv("data/weather_data.csv")
#extracting month and year from date
weather$Date <- as.Date(weather$Date, format= "%m/%d/%Y")
weather$monthina <- as.numeric (format(weather$Date, "%m"))
weather$yearina <- as.numeric (format(weather$Date, "%Y")) + 2000
#creating census years for each data collection period
weather$CensusYearMay <- ifelse(weather$monthina >= 5, (weather$yearina + 1), weather$yearina)
weather$CensusYearJun <- ifelse(weather$monthina >= 6, (weather$yearina + 1), weather$yearina)
weather$CensusYearJul <- ifelse(weather$monthina >= 7, (weather$yearina + 1), weather$yearina)
weather$CensusYearSep <- ifelse(weather$monthina >= 9, (weather$yearina + 1), weather$yearina)
#generating summary stats for each census year
weatherMay <- weather %>%
group_by(
CensusYearMay) %>%
mutate(CensusYearMay_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearMay_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearMay_tmean_mean = sum(`tmean (degrees F)`, na.rm = TRUE),
CensusYearMay_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
weatherJun <- weather %>%
group_by(
CensusYearJun) %>%
mutate(CensusYearJun_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearJun_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearJun_tmean_mean = sum(`tmean (degrees F)`, na.rm = TRUE),
CensusYearJun_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
weatherJul <- weather %>%
group_by(
CensusYearJul) %>%
mutate(CensusYearJul_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearJul_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearJul_tmean_mean = sum(`tmean (degrees F)`, na.rm = TRUE),
CensusYearJul_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
weatherSep <- weather %>%
group_by(
CensusYearSep) %>%
mutate(CensusYearSep_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearSep_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearSep_tmean_mean = sum(`tmean (degrees F)`, na.rm = TRUE),
CensusYearSep_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
#making data frames with only necessary data for each census year
weatherMay <- weatherMay %>%
select(-`tmax (degrees F)`,-`tdmean (degrees F)`,-`vpdmin (hPa)`,-`vpdmax (hPa)`,-`tmin (degrees F)`,
-Date, -monthina, -yearina, -`ppt (inches)`,-`tmean (degrees F)`,
-CensusYearJun, -CensusYearJul, -CensusYearSep) %>%
distinct()
weatherJun <- weatherJun %>%
select(-`tmax (degrees F)`,-`tdmean (degrees F)`,-`vpdmin (hPa)`,-`vpdmax (hPa)`,-`tmin (degrees F)`,
-Date, -monthina, -yearina, -`ppt (inches)`,-`tmean (degrees F)`,
-CensusYearMay, -CensusYearJul, -CensusYearSep) %>%
distinct()
weatherJul <- weatherJul %>%
select(-`tmax (degrees F)`,-`tdmean (degrees F)`,-`vpdmin (hPa)`,-`vpdmax (hPa)`,-`tmin (degrees F)`,
-Date, -monthina, -yearina, -`ppt (inches)`,-`tmean (degrees F)`,
-CensusYearMay, -CensusYearJun, -CensusYearSep) %>%
distinct()
weatherSep <- weatherSep %>%
select(-`tmax (degrees F)`,-`tdmean (degrees F)`,-`vpdmin (hPa)`,-`vpdmax (hPa)`,-`tmin (degrees F)`,
-Date, -monthina, -yearina, -`ppt (inches)`,-`tmean (degrees F)`,
-CensusYearJun, -CensusYearJul, -CensusYearMay) %>%
distinct()
#Combining demographic data with the weather data
gras <- read.csv("data/ltreb_allspp_2007_2025.csv")
CombinedMay <- left_join(x=gras, y=weatherMay, by=c("year_t" = "CensusYearMay")) %>%
rowwise()
CombinedJun <- left_join(x=gras, y=weatherJun, by=c("year_t" = "CensusYearJun")) %>%
rowwise()
CombinedJul <- left_join(x=CombinedMay, y=weatherJul, by=c("year_t" = "CensusYearJul")) %>%
rowwise()
CombinedData <- left_join(x=CombinedJul, y=weatherSep, by=c("year_t" = "CensusYearSep")) %>%
rowwise()
CombinedData$ppt_tot <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_ppt_tot,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "FESU" ~ CombinedData$CensusYearJun_ppt_tot,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "POAL" ~ CombinedData$CensusYearMay_ppt_tot,
gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_tot, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_tot))
CombinedData$ppt_sd <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_ppt_sd,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "FESU" ~ CombinedData$CensusYearJun_ppt_sd,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "POAL" ~ CombinedData$CensusYearMay_ppt_sd,
gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_sd, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_sd))
CombinedData$tmean_mean <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_tmean_mean,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_tmean_mean,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_tmean_mean,
gras$species == "FESU" ~ CombinedData$CensusYearJun_tmean_mean,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_tmean_mean, #fake
gras$species == "POAL" ~ CombinedData$CensusYearMay_tmean_mean,
gras$species == "POAU" ~ CombinedData$CensusYearMay_tmean_mean, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_tmean_mean))
CombinedData$tmean_sd <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_tmean_sd,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_tmean_sd,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_tmean_sd,
gras$species == "FESU" ~ CombinedData$CensusYearJun_tmean_sd,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_tmean_sd,
gras$species == "POAL" ~ CombinedData$CensusYearMay_tmean_sd,
gras$species == "POAU" ~ CombinedData$CensusYearMay_tmean_sd, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_tmean_sd))
library(devtools)
library(remotes)
library(prism)
library(dplyr)
library(tidyr)
#library(terra) #AKIEM - doesn't seem to work or use raster
library(lubridate)
library(tidyverse)
library(dplyr)
library(lme4)
library(AICcmodavg)
library(scales)
library(DHARMa)
library(car)
#reading in downloaded weather data
weather <- read_csv("data/weather_data.csv")
#extracting month and year from date
weather$Date <- as.Date(weather$Date, format= "%m/%d/%Y")
weather$monthina <- as.numeric (format(weather$Date, "%m"))
weather$yearina <- as.numeric (format(weather$Date, "%Y")) + 2000
#creating census years for each data collection period
weather$CensusYearMay <- ifelse(weather$monthina >= 5, (weather$yearina + 1), weather$yearina)
weather$CensusYearJun <- ifelse(weather$monthina >= 6, (weather$yearina + 1), weather$yearina)
weather$CensusYearJul <- ifelse(weather$monthina >= 7, (weather$yearina + 1), weather$yearina)
weather$CensusYearSep <- ifelse(weather$monthina >= 9, (weather$yearina + 1), weather$yearina)
#generating summary stats for each census year
weatherMay <- weather %>%
group_by(
CensusYearMay) %>%
mutate(CensusYearMay_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearMay_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearMay_tmean_mean = sum(`tmean (degrees F)`, na.rm = TRUE),
CensusYearMay_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
weatherJun <- weather %>%
group_by(
CensusYearJun) %>%
mutate(CensusYearJun_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearJun_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearJun_tmean_mean = sum(`tmean (degrees F)`, na.rm = TRUE),
CensusYearJun_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
weatherJul <- weather %>%
group_by(
CensusYearJul) %>%
mutate(CensusYearJul_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearJul_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearJul_tmean_mean = sum(`tmean (degrees F)`, na.rm = TRUE),
CensusYearJul_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
weatherSep <- weather %>%
group_by(
CensusYearSep) %>%
mutate(CensusYearSep_ppt_tot = sum(`ppt (inches)`, na.rm = TRUE),
CensusYearSep_ppt_sd  = sd(`ppt (inches)`, na.rm = TRUE),
CensusYearSep_tmean_mean = sum(`tmean (degrees F)`, na.rm = TRUE),
CensusYearSep_tmean_sd  = sd(`tmean (degrees F)`, na.rm = TRUE))
#making data frames with only necessary data for each census year
weatherMay <- weatherMay %>%
select(-`tmax (degrees F)`,-`tdmean (degrees F)`,-`vpdmin (hPa)`,-`vpdmax (hPa)`,-`tmin (degrees F)`,
-Date, -monthina, -yearina, -`ppt (inches)`,-`tmean (degrees F)`,
-CensusYearJun, -CensusYearJul, -CensusYearSep) %>%
distinct()
weatherJun <- weatherJun %>%
select(-`tmax (degrees F)`,-`tdmean (degrees F)`,-`vpdmin (hPa)`,-`vpdmax (hPa)`,-`tmin (degrees F)`,
-Date, -monthina, -yearina, -`ppt (inches)`,-`tmean (degrees F)`,
-CensusYearMay, -CensusYearJul, -CensusYearSep) %>%
distinct()
weatherJul <- weatherJul %>%
select(-`tmax (degrees F)`,-`tdmean (degrees F)`,-`vpdmin (hPa)`,-`vpdmax (hPa)`,-`tmin (degrees F)`,
-Date, -monthina, -yearina, -`ppt (inches)`,-`tmean (degrees F)`,
-CensusYearMay, -CensusYearJun, -CensusYearSep) %>%
distinct()
weatherSep <- weatherSep %>%
select(-`tmax (degrees F)`,-`tdmean (degrees F)`,-`vpdmin (hPa)`,-`vpdmax (hPa)`,-`tmin (degrees F)`,
-Date, -monthina, -yearina, -`ppt (inches)`,-`tmean (degrees F)`,
-CensusYearJun, -CensusYearJul, -CensusYearMay) %>%
distinct()
#Combining demographic data with the weather data
gras <- read.csv("data/ltreb_allspp_2007_2025.csv")
CombinedMay <- left_join(x=gras, y=weatherMay, by=c("year_t" = "CensusYearMay")) %>%
rowwise()
CombinedJun <- left_join(x=gras, y=weatherJun, by=c("year_t" = "CensusYearJun")) %>%
rowwise()
CombinedJul <- left_join(x=CombinedMay, y=weatherJul, by=c("year_t" = "CensusYearJul")) %>%
rowwise()
CombinedData <- left_join(x=CombinedJul, y=weatherSep, by=c("year_t" = "CensusYearSep")) %>%
rowwise()
CombinedData$ppt_tot <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_ppt_tot,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "FESU" ~ CombinedData$CensusYearJun_ppt_tot,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "POAL" ~ CombinedData$CensusYearMay_ppt_tot,
gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_tot, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_tot))
CombinedData$ppt_sd <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_ppt_sd,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "FESU" ~ CombinedData$CensusYearJun_ppt_sd,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "POAL" ~ CombinedData$CensusYearMay_ppt_sd,
gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_sd, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_sd))
#Combining demographic data with the weather data
gras <- read.csv("data/ltreb_allspp_2007_2025.csv")
CombinedMay <- left_join(x=gras, y=weatherMay, by=c("year_t" = "CensusYearMay")) %>%
rowwise()
View(CombinedMay)
CombinedJun <- left_join(x=CombinedMay, y=weatherJun, by=c("year_t" = "CensusYearJun")) %>%
rowwise()
View(CombinedJun)
CombinedJul <- left_join(x=CombinedJun, y=weatherJul, by=c("year_t" = "CensusYearJul")) %>%
rowwise()
CombinedData <- left_join(x=CombinedJul, y=weatherSep, by=c("year_t" = "CensusYearSep")) %>%
rowwise()
CombinedData$ppt_tot <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_ppt_tot,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "FESU" ~ CombinedData$CensusYearJun_ppt_tot,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_ppt_tot,
gras$species == "POAL" ~ CombinedData$CensusYearMay_ppt_tot,
gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_tot, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_tot))
CombinedData$ppt_sd <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_ppt_sd,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "FESU" ~ CombinedData$CensusYearJun_ppt_sd,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_ppt_sd,
gras$species == "POAL" ~ CombinedData$CensusYearMay_ppt_sd,
gras$species == "POAU" ~ CombinedData$CensusYearMay_ppt_sd, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_ppt_sd))
CombinedData$tmean_mean <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_tmean_mean,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_tmean_mean,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_tmean_mean,
gras$species == "FESU" ~ CombinedData$CensusYearJun_tmean_mean,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_tmean_mean, #fake
gras$species == "POAL" ~ CombinedData$CensusYearMay_tmean_mean,
gras$species == "POAU" ~ CombinedData$CensusYearMay_tmean_mean, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_tmean_mean))
CombinedData$tmean_sd <- as.numeric (case_when(gras$species == "AGPE" ~ CombinedData$CensusYearSep_tmean_sd,
gras$species == "ELRI" ~ CombinedData$CensusYearJul_tmean_sd,
gras$species == "ELVI" ~ CombinedData$CensusYearJul_tmean_sd,
gras$species == "FESU" ~ CombinedData$CensusYearJun_tmean_sd,
gras$species == "LOAR" ~ CombinedData$CensusYearJul_tmean_sd,
gras$species == "POAL" ~ CombinedData$CensusYearMay_tmean_sd,
gras$species == "POAU" ~ CombinedData$CensusYearMay_tmean_sd, #fake (I don't know the census date)
gras$species == "POSY" ~ CombinedData$CensusYearMay_tmean_sd))
str(CombinedData)
CombinedDataRefined <- CombinedData %>% select(X, species, plot, endo_01, id, origin, original, birth,
year_t, age, size_t, flw_count_t, mean_spike_t,
year_t1, surv_t1, size_t1, flw_count_t1, mean_spike_t1,
dist_a, dist_b, ppt_tot, ppt_sd, tmean_mean, tmean_sd)
View(CombinedDataRefined)
write.csv(CombinedDataRefined, "CombinedDataRefined")
?write.csv
write.csv(CombinedDataRefined, "data/CombinedDataRefined")
#Important packages
library(tidyverse)
library(lme4)
library(rstan)
library(googlesheets4)
library(bayesplot)
options(mc.cores = parallel::detectCores())
#setwd("G:/.shortcut-targets-by-id/1o66WMnQligL0_-ahkQMfFOklR3X-6vOA/Akiem PhD Research/Data & Analysis")
setwd("/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage")
gras <- read.csv("data/ltreb_allspp_2007_2025.csv")
##Species filter
poaals <- gras %>% filter(species == "POAL")
poaals$log_tillers_centered <- log(poaals$size_t) - mean(log(poaals$size_t),na.rm=T)
##prep data, dropping NAs
poaals %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> poaals_flow
poal_flow_dat <- list(n_obs=nrow(poaals_flow),
y=poaals_flow$flw_count_t>0,
n_yrs = length(unique(poaals_flow$year_t)),
n_plots = max(poaals_flow$plot),
n_endo = 2,
endo_01=poaals_flow$endo_01,
size=poaals_flow$log_tillers_centered,
year_index=poaals_flow$year_t-2006,
plot=poaals_flow$plot)
poal_flow_model = stan_model(file="/Users/akiemgough/Library/CloudStorage/GoogleDrive-ag285@rice.edu/My Drive/Akiem PhD Research/GitHub/Temporal-Storage/code/earlier_flowering.stan")
poal_flow_model = stan_model(file="code/earlier_flowering.stan")
poal_flow_sampling<-sampling(poal_flow_model,
data=poal_flow_dat,
chains = 3,
iter = 5000,
warmup = 1000)
#Something is being done
params_poal_f<-rstan::extract(poal_flow_sampling,pars=c('beta_0','endo_effect'))
dim(params_poal_f$beta_0)
#take a random subset of posterior draws
poal_endoeffect_postf<-params_poal_f$endo_effect[sample(12000,size=500,replace=F),]
dim(poal_endoeffect_postf)
# Convert to long data frame
long_df_poal_f <- as.data.frame.table(poal_endoeffect_postf,
responseName = "value") %>%
rename(draw = iterations, year = Var2) %>%
mutate(draw = as.integer(draw), year = as.integer(year)+2006)
summary_df_poal_f <- long_df_poal_f %>%
group_by(year) %>%
summarize(
median = median(value),
lower = quantile(value, 0.05),
upper = quantile(value, 0.95),
probgzero = mean(value>0),
.groups = "drop")
#plot
ggplot(summary_df_poal_f, aes(x = year, y = median)) +
geom_line(linewidth = 1.2) +
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
labs(x = "Year", y = "Endophyte effect",
title = "POAL: Difference of E+ and E- flowering with year") +
geom_hline(yintercept = 0) +
theme_minimal()
##Species filter
agrper <- gras %>% filter(species == "AGPE")
agrper$log_tillers_centered <- log(agrper$size_t) - mean(log(agrper$size_t),na.rm=T)
##prep data, dropping NAs
agrper %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot) %>%
drop_na() -> agrper_flow
agpe_flow_dat <- list(n_obs=nrow(agrper_flow),
y=agrper_flow$flw_count_t>0,
n_yrs = length(unique(agrper_flow$year_t)),
n_plots = max(agrper_flow$plot),
n_endo = 2,
endo_01=agrper_flow$endo_01,
size=agrper_flow$log_tillers_centered,
year_index=agrper_flow$year_t-2006,
plot=agrper_flow$plot)
agpe_flow_model = stan_model(file="code/earlier_flowering.stan")
agpe_flow_sampling<-sampling(agpe_flow_model,
data=agpe_flow_dat,
chains = 1, #following prompt to check when only 1 chain
iter = 5000,
warmup = 1000)
View(agrper_flow)
agpe_flow_dat <- list(n_obs=nrow(agrper_flow),
y=agrper_flow$flw_count_t>0,
n_yrs = length(unique(agrper_flow$year_t)),
n_plots = max(agrper_flow$plot),
n_endo = 2,
endo_01=agrper_flow$endo_01,
size=log(agrper_flow$size_t),
year_index=agrper_flow$year_t-2006,
plot=agrper_flow$plot)
##prep data, dropping NAs
agrper %>%
select(flw_count_t,endo_01,log_tillers_centered,year_t,plot,size_t) %>%
drop_na() -> agrper_flow
agpe_flow_dat <- list(n_obs=nrow(agrper_flow),
y=agrper_flow$flw_count_t>0,
n_yrs = length(unique(agrper_flow$year_t)),
n_plots = max(agrper_flow$plot),
n_endo = 2,
endo_01=agrper_flow$endo_01,
size=log(agrper_flow$size_t),
year_index=agrper_flow$year_t-2006,
plot=agrper_flow$plot)
agpe_flow_model = stan_model(file="code/earlier_flowering.stan")
agpe_flow_model
agpe_flow_sampling<-sampling(agpe_flow_model,
data=agpe_flow_dat,
chains = 1, #following prompt to check when only 1 chain
iter = 5000,
warmup = 1000)
